<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualizador de Tela Remota (ADM)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background-color: #282c34;
        color: #61dafb;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
      }

      h1 {
        color: #61dafb;
        margin-bottom: 20px;
      }

      #screenStream {
        max-width: 90vw;
        max-height: 80vh;
        border: 2px solid #61dafb;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(97, 218, 251, 0.5);
        background-color: #3a4049; /* Fundo para quando não há imagem */
      }

      #status {
        margin-top: 20px;
        font-size: 1.1em;
        color: #a0a8b4;
      }

      .connected {
        color: #4caf50; /* Verde */
      }

      .disconnected {
        color: #f44336; /* Vermelho */
      }
    </style>
  </head>
  <body>
    <h1>Visualizador de Tela Remota</h1>
    <img id="screenStream" src="" alt="Tela do Usuário" />
    <p id="status">Status: Desconectado</p>

    <script type="module">
      const screenStream = document.getElementById("screenStream");
      const statusElement = document.getElementById("status");
      const ws = new WebSocket("ws://localhost:1090/ws");

      ws.onopen = () => {
        console.log("Conectado ao servidor WebSocket como administrador.");
        ws.send(
          JSON.stringify({
            message: "CLIENT_CONNECT",
            id: "bbecc326-b6b1-4b85-a033-d953cc67d50f",
            idStream: "e2e8d430-d0d3-4b1a-b55f-b8ca296913a5",
          })
        );
        statusElement.textContent = "Status: Conectado e Aguardando Stream";
        statusElement.className = "connected";
      };

      ws.onmessage = (event) => {
        if (typeof event.data === "string" && !event.data.startsWith("/9j/")) {
          alert(
            event.data === "CLIENT_OK"
              ? "Servidor confirmou conexão de administrador."
              : event.data
          );

          if (event.data.startsWith("/9j/")) {
            screenStream.src = "data:image/jpeg;base64," + event.data;
          } else if (event.data.startsWith("iVBORw0KGgo")) {
            screenStream.src = "data:image/png;base64," + event.data;
          } else if (event.data.startsWith("data:image/")) {
            screenStream.src = event.data;
          } else {
            console.log("Mensagem de texto do servidor:", event.data);
          }
        } else if (event.data instanceof Blob) {
          const imageUrl = URL.createObjectURL(event.data);
          screenStream.src = imageUrl;

          screenStream.onload = () => {
            URL.revokeObjectURL(imageUrl);
          };
        } else {
          console.log("Dados recebidos de tipo desconhecido:", event.data);
        }
      };

      ws.onclose = () => {
        console.log("Conexão WebSocket fechada.");
        statusElement.textContent = "Status: Desconectado";
        statusElement.className = "disconnected";
        screenStream.src = "";
      };

      ws.onerror = (error) => {
        console.error("Erro na conexão WebSocket:", error);
        statusElement.textContent = "Status: Erro na Conexão";
        statusElement.className = "disconnected";
      };
    </script>
  </body>
</html>
